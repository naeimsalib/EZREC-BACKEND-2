michomanoly14892@raspberrypi:~/EZREC-BACKEND-2 $ git pull
remote: Enumerating objects: 10, done.
remote: Counting objects: 100% (10/10), done.
remote: Compressing objects: 100% (1/1), done.
remote: Total 6 (delta 5), reused 6 (delta 5), pack-reused 0 (from 0)
Unpacking objects: 100% (6/6), 1.39 KiB | 711.00 KiB/s, done.
From https://github.com/naeimsalib/EZREC-BACKEND-2
   a297bf2..7e66791  main       -> origin/main
Updating a297bf2..7e66791
error: Your local changes to the following files would be overwritten by merge:
        quick_test.sh
Please commit your changes or stash them before you merge.
Aborting
michomanoly14892@raspberrypi:~/EZREC-BACKEND-2 $ git stash
Saved working directory and index state WIP on main: a297bf2 Add quick test scripts for recording verification
michomanoly14892@raspberrypi:~/EZREC-BACKEND-2 $ git pull
Updating a297bf2..7e66791
Fast-forward
 backend/dual_recorder.py |  5 +++--
 immediate_test.sh        | 97 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 quick_test.sh            |  8 +++++---
 3 files changed, 105 insertions(+), 5 deletions(-)
 create mode 100644 immediate_test.sh
michomanoly14892@raspberrypi:~/EZREC-BACKEND-2 $ sudo chmod +x immediate_test.sh 
michomanoly14892@raspberrypi:~/EZREC-BACKEND-2 $ sudo ./immediate_test.sh 
üöÄ EZREC Immediate Recording Test
=================================
1Ô∏è‚É£ Testing Service Status...
  dual_recorder.service: active
  video_worker.service: active
  ezrec-api.service: active
  system_status.service: active
  cloudflared.service: active
2Ô∏è‚É£ Testing API Endpoints...
  Testing /test-alive...
    ‚úÖ Success: {"status":"alive"}...
  Testing /status...
    ‚úÖ Success: {"status":"running","timestamp":"2025-09-14T22:48:32.857007","version":"1.0.0"}...
  Testing /api/bookings...
    ‚úÖ Success: [{"id":"test-1757903677","user_id":"test-user","start_time":"2025-09-14T22:35:37","end_time":"2025-0...
  Testing /api/cameras...
    ‚úÖ Success: {"cameras":[{"id":"camera_0","name":"Available cameras","status":"available"},{"id":"camera_1","name...
  Testing /api/recordings...
    ‚úÖ Success: []...
3Ô∏è‚É£ Testing Camera Detection...
  Camera devices:
crw-rw-rw-+ 1 root video 81,  0 Sep 10 11:17 /dev/video0
crw-rw-rw-+ 1 root video 81, 18 Sep 10 11:17 /dev/video1
crw-rw----+ 1 root video 81, 30 Sep 10 11:17 /dev/video10
crw-rw----+ 1 root video 81, 31 Sep 10 11:17 /dev/video11
crw-rw----+ 1 root video 81, 32 Sep 10 11:17 /dev/video12
crw-rw----+ 1 root video 81, 33 Sep 10 11:17 /dev/video13
crw-rw----+ 1 root video 81, 34 Sep 10 11:17 /dev/video14
crw-rw----+ 1 root video 81, 35 Sep 10 11:17 /dev/video15
crw-rw----+ 1 root video 81, 36 Sep 10 11:17 /dev/video16
crw-rw----+ 1 root video 81,  3 Sep 10 11:17 /dev/video19
crw-rw----+ 1 root video 81, 19 Sep 10 11:17 /dev/video2
crw-rw----+ 1 root video 81,  1 Sep 10 11:17 /dev/video20
crw-rw----+ 1 root video 81,  2 Sep 10 11:17 /dev/video21
crw-rw----+ 1 root video 81,  4 Sep 10 11:17 /dev/video22
crw-rw----+ 1 root video 81,  5 Sep 10 11:17 /dev/video23
crw-rw----+ 1 root video 81,  6 Sep 10 11:17 /dev/video24
crw-rw----+ 1 root video 81,  7 Sep 10 11:17 /dev/video25
crw-rw----+ 1 root video 81,  8 Sep 10 11:17 /dev/video26
crw-rw----+ 1 root video 81,  9 Sep 10 11:17 /dev/video27
crw-rw----+ 1 root video 81, 10 Sep 10 11:17 /dev/video28
crw-rw----+ 1 root video 81, 11 Sep 10 11:17 /dev/video29
crw-rw----+ 1 root video 81, 20 Sep 10 11:17 /dev/video3
crw-rw----+ 1 root video 81, 12 Sep 10 11:17 /dev/video30
crw-rw----+ 1 root video 81, 13 Sep 10 11:17 /dev/video31
crw-rw----+ 1 root video 81, 14 Sep 10 11:17 /dev/video32
crw-rw----+ 1 root video 81, 15 Sep 10 11:17 /dev/video33
crw-rw----+ 1 root video 81, 16 Sep 10 11:17 /dev/video34
crw-rw----+ 1 root video 81, 17 Sep 10 11:17 /dev/video35
crw-rw----+ 1 root video 81, 21 Sep 10 11:17 /dev/video4
crw-rw----+ 1 root video 81, 22 Sep 10 11:17 /dev/video5
crw-rw----+ 1 root video 81, 23 Sep 10 11:17 /dev/video6
crw-rw----+ 1 root video 81, 24 Sep 10 11:17 /dev/video7
crw-rw----+ 1 root video 81, 25 Sep 10 11:17 /dev/video8
crw-rw----+ 1 root video 81, 29 Sep 10 11:17 /dev/video9
  rpicam-vid test:
Available cameras
-----------------
0 : imx477 [4056x3040 12-bit] (/base/axi/pcie@1000120000/rp1/i2c@88000/imx477@1a)
    Modes: 'SBGGR10_CSI2P' : 1332x990 [30.00 fps - (65535, 65535)/65535x65535 crop]
           'SBGGR12_CSI2P' : 2028x1080 [30.00 fps - (65535, 65535)/65535x65535 crop]
4Ô∏è‚É£ Creating Immediate Test Booking...
  Booking ID: immediate-test-1757904512
  Start: 2025-09-14T22:48:32 (NOW)
  End: 2025-09-14T22:50:32
  ‚úÖ Booking created
5Ô∏è‚É£ Monitoring Recording (should start immediately)...
  üé¨ Starting recording monitoring...
  --- Check 1/15 ---
    Dual Recorder:
Sep 14 22:48:32 raspberrypi python3[617226]: 2025-09-14 22:48:32,592 - dual_recorder - INFO - üìä Status: Active booking: False, Recording: False
Sep 14 22:48:32 raspberrypi python3[617226]: 2025-09-14 22:48:32,592 - dual_recorder - INFO - ‚è∏Ô∏è No active booking, no recording
    Recording processes: 1
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 12.4  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
Sep 14 22:48:32 raspberrypi uvicorn[617195]: INFO:     127.0.0.1:38232 - "GET /test-alive HTTP/1.1" 200 OK
Sep 14 22:48:32 raspberrypi uvicorn[617195]: INFO:     127.0.0.1:38246 - "GET /status HTTP/1.1" 200 OK
Sep 14 22:48:32 raspberrypi uvicorn[617195]: INFO:     127.0.0.1:38254 - "GET /api/bookings HTTP/1.1" 200 OK
Sep 14 22:48:32 raspberrypi uvicorn[617195]: INFO:     127.0.0.1:38270 - "GET /api/cameras HTTP/1.1" 200 OK
Sep 14 22:48:32 raspberrypi uvicorn[617195]: INFO:     127.0.0.1:38286 - "GET /api/recordings HTTP/1.1" 200 OK
  --- Check 2/15 ---
    Dual Recorder:
Sep 14 22:48:39 raspberrypi python3[617226]: [106:37:34.667715286] [619396]  INFO Camera camera.cpp:1011 Pipeline handler in use by another process
Sep 14 22:48:39 raspberrypi python3[617226]: ERROR: *** failed to acquire camera /base/axi/pcie@1000120000/rp1/i2c@88000/imx477@1a ***
    Recording processes: 1
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 12.3  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
  --- Check 3/15 ---
    Dual Recorder:
Sep 14 22:48:51 raspberrypi python3[617226]: 2025-09-14 22:48:51,726 - dual_recorder - INFO - üîç Testing camera availability...
Sep 14 22:48:51 raspberrypi python3[617226]: 2025-09-14 22:48:51,793 - dual_recorder - INFO - ‚úÖ Cameras available, starting recording...
    Recording processes: 3
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 12.1  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
michoma+  619475  3.7  0.0      0     0 ?        Z    22:48   0:00 [rpicam-vid] <defunct>
michoma+  619476  3.7  0.0      0     0 ?        Z    22:48   0:00 [rpicam-vid] <defunct>
  --- Check 4/15 ---
    Dual Recorder:
Sep 14 22:49:00 raspberrypi python3[617226]: [106:37:55.835545020] [619521]  INFO Camera camera.cpp:1011 Pipeline handler in use by another process
Sep 14 22:49:00 raspberrypi python3[617226]: ERROR: *** failed to acquire camera /base/axi/pcie@1000120000/rp1/i2c@88000/imx477@1a ***
    Recording processes: 1
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 12.0  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
  --- Check 5/15 ---
    Dual Recorder:
Sep 14 22:49:12 raspberrypi python3[617226]: 2025-09-14 22:49:12,883 - dual_recorder - INFO - üîç Testing camera availability...
Sep 14 22:49:12 raspberrypi python3[617226]: 2025-09-14 22:49:12,925 - dual_recorder - INFO - ‚úÖ Cameras available, starting recording...
    Recording processes: 3
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 11.8  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
michoma+  619595 18.5  0.0      0     0 ?        Z    22:49   0:00 [rpicam-vid] <defunct>
michoma+  619596 18.5  0.0      0     0 ?        Z    22:49   0:00 [rpicam-vid] <defunct>
  --- Check 6/15 ---
    Dual Recorder:
Sep 14 22:49:21 raspberrypi python3[617226]: [106:38:16.966619887] [619641]  INFO Camera camera.cpp:1011 Pipeline handler in use by another process
Sep 14 22:49:21 raspberrypi python3[617226]: ERROR: *** failed to acquire camera /base/axi/pcie@1000120000/rp1/i2c@88000/imx477@1a ***
    Recording processes: 1
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 11.7  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
  --- Check 7/15 ---
    Dual Recorder:
Sep 14 22:49:29 raspberrypi python3[617226]: [106:38:24.010566376] [619687]  INFO Camera camera.cpp:1011 Pipeline handler in use by another process
Sep 14 22:49:29 raspberrypi python3[617226]: ERROR: *** failed to acquire camera /base/axi/pcie@1000120000/rp1/i2c@88000/imx477@1a ***
    Recording processes: 1
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 11.5  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
  --- Check 8/15 ---
    Dual Recorder:
Sep 14 22:49:43 raspberrypi python3[617226]: [106:38:38.129461472] [619761]  INFO Camera camera.cpp:1011 Pipeline handler in use by another process
Sep 14 22:49:43 raspberrypi python3[617226]: ERROR: *** failed to acquire camera /base/axi/pcie@1000120000/rp1/i2c@88000/imx477@1a ***
    Recording processes: 1
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 11.4  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
  --- Check 9/15 ---
    Dual Recorder:
Sep 14 22:49:50 raspberrypi python3[617226]: [106:38:45.167140511] [619808]  INFO Camera camera.cpp:1011 Pipeline handler in use by another process
Sep 14 22:49:50 raspberrypi python3[617226]: ERROR: *** failed to acquire camera /base/axi/pcie@1000120000/rp1/i2c@88000/imx477@1a ***
    Recording processes: 1
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 11.3  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
  --- Check 10/15 ---
    Dual Recorder:
Sep 14 22:50:02 raspberrypi python3[617226]: 2025-09-14 22:50:02,214 - dual_recorder - INFO - üîç Testing camera availability...
Sep 14 22:50:02 raspberrypi python3[617226]: 2025-09-14 22:50:02,256 - dual_recorder - INFO - ‚úÖ Cameras available, starting recording...
    Recording processes: 3
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 11.1  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
michoma+  619890  4.4  0.0      0     0 ?        Z    22:50   0:00 [rpicam-vid] <defunct>
michoma+  619891  4.4  0.0      0     0 ?        Z    22:50   0:00 [rpicam-vid] <defunct>
  --- Check 11/15 ---
    Dual Recorder:
Sep 14 22:50:11 raspberrypi python3[617226]: [106:39:06.297613386] [619936]  INFO Camera camera.cpp:1011 Pipeline handler in use by another process
Sep 14 22:50:11 raspberrypi python3[617226]: ERROR: *** failed to acquire camera /base/axi/pcie@1000120000/rp1/i2c@88000/imx477@1a ***
    Recording processes: 1
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 11.0  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
  --- Check 12/15 ---
    Dual Recorder:
Sep 14 22:50:23 raspberrypi python3[617226]: 2025-09-14 22:50:23,344 - dual_recorder - INFO - üîç Testing camera availability...
Sep 14 22:50:23 raspberrypi python3[617226]: 2025-09-14 22:50:23,386 - dual_recorder - INFO - ‚úÖ Cameras available, starting recording...
    Recording processes: 3
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 10.9  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
michoma+  620010 55.5  0.0      0     0 ?        Z    22:50   0:00 [rpicam-vid] <defunct>
michoma+  620011 55.5  0.0      0     0 ?        Z    22:50   0:00 [rpicam-vid] <defunct>
  --- Check 13/15 ---
    Dual Recorder:
Sep 14 22:50:32 raspberrypi python3[617226]: [106:39:27.464316860] [620057]  INFO Camera camera.cpp:1011 Pipeline handler in use by another process
Sep 14 22:50:32 raspberrypi python3[617226]: ERROR: *** failed to acquire camera /base/axi/pcie@1000120000/rp1/i2c@88000/imx477@1a ***
    Recording processes: 1
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 10.8  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
  --- Check 14/15 ---
    Dual Recorder:
Sep 14 22:50:42 raspberrypi python3[617226]: 2025-09-14 22:50:42,451 - dual_recorder - INFO - üìä Status: Active booking: False, Recording: False
Sep 14 22:50:42 raspberrypi python3[617226]: 2025-09-14 22:50:42,451 - dual_recorder - INFO - ‚è∏Ô∏è No active booking, no recording
    Recording processes: 1
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 10.6  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
  --- Check 15/15 ---
    Dual Recorder:
Sep 14 22:50:52 raspberrypi python3[617226]: 2025-09-14 22:50:52,452 - dual_recorder - INFO - üìä Status: Active booking: False, Recording: False
Sep 14 22:50:52 raspberrypi python3[617226]: 2025-09-14 22:50:52,452 - dual_recorder - INFO - ‚è∏Ô∏è No active booking, no recording
    Recording processes: 1
    New recording files: 0
    Active rpicam-vid processes:
michoma+  618055 10.5  2.0 1103280 169440 ?      SLl  22:35   1:36 rpicam-vid --width 1280 --height 720 --framerate 25 --output /opt/ezrec-backend/recordings/2025-09-14/session_test-1757903677/camera_1_20250914_223537.mp4 --timeout 300000
‚úÖ Immediate test completed
michomanoly14892@raspberrypi:~/EZREC-BACKEND-2 $ 