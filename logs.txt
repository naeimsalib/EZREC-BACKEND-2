# EZREC System Test Logs
# This file will be populated by the automated test script
[0;32m[22:21:37] Starting EZREC deployment as user: root[0m
[0;34m[22:21:37] STEP: 1. Applying comprehensive system fixes[0m
[0;32m[22:21:37] ğŸ”§ Fixing port conflicts with comprehensive cleanup...[0m
[0;32m[22:21:37] ğŸ§¹ Performing comprehensive system cleanup...[0m
[0;32m[22:21:37] ğŸ›‘ Stopping all EZREC services...[0m
[0;32m[22:21:38] ğŸ“· Killing all camera-related processes...[0m
[0;32m[22:21:38] ğŸ Killing Python camera processes...[0m
[0;32m[22:21:38] ğŸ”“ Clearing camera device locks...[0m
[0;32m[22:21:39] ğŸ—‘ï¸ Clearing booking cache...[0m
[0;32m[22:21:39] ğŸ—‘ï¸ Clearing temporary recording files...[0m
[0;32m[22:21:39] ğŸ”„ Resetting camera devices...[0m
[0;32m[22:21:42] âœ… Comprehensive system cleanup completed[0m
[0;32m[22:21:42] ğŸ§¹ Comprehensive port cleanup...[0m
[0;32m[22:21:42] ğŸ§¹ Killing processes by name...[0m
[0;32m[22:21:42] ğŸ§¹ Killing any remaining Python service processes...[0m
[0;32m[22:21:44] ğŸ§¹ Force killing any remaining processes on ports 8000 and 9000...[0m
[0;32m[22:21:47] âœ… Port 8000 is now free[0m
[0;32m[22:21:47] âœ… Port 9000 is now free[0m
[0;32m[22:21:47] âœ… Comprehensive port conflict resolution completed[0m
[0;32m[22:21:47] ğŸ—‘ï¸ Clearing old recordings and temporary files...[0m
[0;32m[22:21:47] ğŸ—‘ï¸ Clearing temporary files...[0m
[0;32m[22:21:47] ğŸ—‘ï¸ Clearing old log files...[0m
[0;32m[22:21:47] ğŸ—‘ï¸ Clearing old systemd journal logs...[0m
[0;32m[22:21:47] âœ… Old recordings and temporary files cleared[0m
[0;32m[22:21:47] ğŸ“‹ Initializing fresh booking cache...[0m
[0;32m[22:21:47] âœ… Fresh booking cache initialized[0m
[0;32m[22:21:47] ğŸ”§ Installing psutil in all virtual environments...[0m
[0;32m[22:21:47] ğŸ“¦ Installing psutil in backend virtual environment...[0m
Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
Requirement already satisfied: psutil in /home/michomanoly14892/.local/lib/python3.11/site-packages (5.9.5)
WARNING: Error parsing dependencies of send2trash: Expected matching RIGHT_PARENTHESIS for LEFT_PARENTHESIS, after version specifier
    sys-platform (=="darwin") ; extra == 'objc'
                 ~^
[0;32m[22:21:49] âœ… psutil installed successfully in backend venv[0m
[0;32m[22:21:49] ğŸ“¦ Installing psutil in API virtual environment...[0m
Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
Requirement already satisfied: psutil in /home/michomanoly14892/.local/lib/python3.11/site-packages (5.9.5)
WARNING: Error parsing dependencies of send2trash: Expected matching RIGHT_PARENTHESIS for LEFT_PARENTHESIS, after version specifier
    sys-platform (=="darwin") ; extra == 'objc'
                 ~^
[0;32m[22:21:51] âœ… psutil installed successfully in API venv[0m
[0;32m[22:21:51] ğŸ§ª Testing psutil imports...[0m
âœ… psutil imported successfully in backend
[0;32m[22:21:51] âœ… psutil import test passed in backend[0m
âœ… psutil imported successfully in API
[0;32m[22:21:51] âœ… psutil import test passed in API[0m
[0;32m[22:21:51] âœ… psutil installed and tested successfully in all environments[0m
[0;32m[22:21:51] ğŸ“ Copying all project files to deployment directory...[0m
[0;32m[22:21:51] ğŸ“„ Copying backend files...[0m
[0;32m[22:21:51] âœ… Backend files copied successfully[0m
[0;32m[22:21:51] ğŸ“„ Copying API files...[0m
[0;32m[22:21:51] âœ… API files copied successfully[0m
[0;32m[22:21:51] ğŸ“„ Copying systemd service files...[0m
[0;32m[22:21:52] âœ… Systemd service files copied and reloaded[0m
[0;32m[22:21:52] ğŸ“„ Copying updated system_status.py...[0m
[0;32m[22:21:52] âœ… system_status.py updated successfully[0m
[0;32m[22:21:52] ğŸ“„ Copying services directory...[0m
[0;32m[22:21:52] âœ… Services directory copied successfully[0m
[0;32m[22:21:52] ğŸ“„ Copying config directory...[0m
[0;32m[22:21:52] âœ… Config directory copied successfully[0m
[0;32m[22:21:52] ğŸ“„ Copying utils directory...[0m
[0;32m[22:21:52] âœ… Utils directory copied successfully[0m
[0;32m[22:21:52] ğŸ”’ Existing .env file found in deployment directory - preserving it[0m
[0;32m[22:21:52] â„¹ï¸ To update .env, manually edit: /opt/ezrec-backend/.env[0m
[0;32m[22:21:52] âœ… All project files copied successfully[0m
[0;32m[22:21:52] ğŸ”§ Installing new architecture dependencies...[0m
[0;32m[22:21:52] ğŸ“¦ Installing new architecture dependencies in backend virtual environment...[0m
[0;32m[22:21:52] ğŸ“¦ Installing pytz...[0m
Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
Requirement already satisfied: pytz in /usr/lib/python3/dist-packages (2022.7.1)
WARNING: Error parsing dependencies of send2trash: Expected matching RIGHT_PARENTHESIS for LEFT_PARENTHESIS, after version specifier
    sys-platform (=="darwin") ; extra == 'objc'
                 ~^
[0;32m[22:21:54] âœ… pytz installed successfully[0m
[0;32m[22:21:54] ğŸ“¦ Installing python-dotenv...[0m
Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
Requirement already satisfied: python-dotenv in /home/michomanoly14892/.local/lib/python3.11/site-packages (1.0.0)
WARNING: Error parsing dependencies of send2trash: Expected matching RIGHT_PARENTHESIS for LEFT_PARENTHESIS, after version specifier
    sys-platform (=="darwin") ; extra == 'objc'
                 ~^
[0;32m[22:21:55] âœ… python-dotenv installed successfully[0m
[0;32m[22:21:55] ğŸ“¦ Installing supabase...[0m
Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
Requirement already satisfied: supabase in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (2.0.2)
Requirement already satisfied: gotrue<2.0.0,>=1.3.0 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from supabase) (1.3.1)
Requirement already satisfied: httpx<0.25.0,>=0.24.0 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from supabase) (0.24.1)
Requirement already satisfied: postgrest<0.14.0,>=0.10.8 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from supabase) (0.13.2)
Requirement already satisfied: realtime<2.0.0,>=1.0.0 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from supabase) (1.0.6)
Requirement already satisfied: storage3<0.7.0,>=0.5.3 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from supabase) (0.6.1)
Requirement already satisfied: supafunc<0.4.0,>=0.3.1 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from supabase) (0.3.3)
Requirement already satisfied: pydantic<3,>=1.10 in /home/michomanoly14892/.local/lib/python3.11/site-packages (from gotrue<2.0.0,>=1.3.0->supabase) (2.11.7)
Requirement already satisfied: certifi in /home/michomanoly14892/.local/lib/python3.11/site-packages (from httpx<0.25.0,>=0.24.0->supabase) (2025.6.15)
Requirement already satisfied: httpcore<0.18.0,>=0.15.0 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from httpx<0.25.0,>=0.24.0->supabase) (0.17.3)
Requirement already satisfied: idna in /home/michomanoly14892/.local/lib/python3.11/site-packages (from httpx<0.25.0,>=0.24.0->supabase) (3.10)
Requirement already satisfied: sniffio in /home/michomanoly14892/.local/lib/python3.11/site-packages (from httpx<0.25.0,>=0.24.0->supabase) (1.3.1)
Requirement already satisfied: h11<0.15,>=0.13 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from httpcore<0.18.0,>=0.15.0->httpx<0.25.0,>=0.24.0->supabase) (0.14.0)
Requirement already satisfied: anyio<5.0,>=3.0 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from httpcore<0.18.0,>=0.15.0->httpx<0.25.0,>=0.24.0->supabase) (3.7.1)
Requirement already satisfied: deprecation<3.0.0,>=2.1.0 in /home/michomanoly14892/.local/lib/python3.11/site-packages (from postgrest<0.14.0,>=0.10.8->supabase) (2.1.0)
Requirement already satisfied: strenum<0.5.0,>=0.4.9 in /home/michomanoly14892/.local/lib/python3.11/site-packages (from postgrest<0.14.0,>=0.10.8->supabase) (0.4.15)
Requirement already satisfied: packaging in /home/michomanoly14892/.local/lib/python3.11/site-packages (from deprecation<3.0.0,>=2.1.0->postgrest<0.14.0,>=0.10.8->supabase) (25.0)
Requirement already satisfied: annotated-types>=0.6.0 in /home/michomanoly14892/.local/lib/python3.11/site-packages (from pydantic<3,>=1.10->gotrue<2.0.0,>=1.3.0->supabase) (0.7.0)
Requirement already satisfied: pydantic-core==2.33.2 in /home/michomanoly14892/.local/lib/python3.11/site-packages (from pydantic<3,>=1.10->gotrue<2.0.0,>=1.3.0->supabase) (2.33.2)
Requirement already satisfied: typing-extensions>=4.12.2 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from pydantic<3,>=1.10->gotrue<2.0.0,>=1.3.0->supabase) (4.15.0)
Requirement already satisfied: typing-inspection>=0.4.0 in /home/michomanoly14892/.local/lib/python3.11/site-packages (from pydantic<3,>=1.10->gotrue<2.0.0,>=1.3.0->supabase) (0.4.1)
Requirement already satisfied: python-dateutil<3.0.0,>=2.8.1 in /home/michomanoly14892/.local/lib/python3.11/site-packages (from realtime<2.0.0,>=1.0.0->supabase) (2.9.0.post0)
Requirement already satisfied: websockets<13,>=11 in /home/michomanoly14892/.local/lib/python3.11/site-packages (from realtime<2.0.0,>=1.0.0->supabase) (12.0)
Requirement already satisfied: six>=1.5 in /home/michomanoly14892/.local/lib/python3.11/site-packages (from python-dateutil<3.0.0,>=2.8.1->realtime<2.0.0,>=1.0.0->supabase) (1.17.0)
WARNING: Error parsing dependencies of send2trash: Expected matching RIGHT_PARENTHESIS for LEFT_PARENTHESIS, after version specifier
    sys-platform (=="darwin") ; extra == 'objc'
                 ~^
[0;32m[22:21:57] âœ… supabase installed successfully[0m
[0;32m[22:21:57] ğŸ“¦ Installing boto3...[0m
Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
Requirement already satisfied: boto3 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (1.34.0)
Requirement already satisfied: botocore<1.35.0,>=1.34.0 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from boto3) (1.34.162)
Requirement already satisfied: jmespath<2.0.0,>=0.7.1 in /usr/lib/python3/dist-packages (from boto3) (1.0.1)
Requirement already satisfied: s3transfer<0.10.0,>=0.9.0 in /opt/ezrec-backend/backend/venv/lib/python3.11/site-packages (from boto3) (0.9.0)
Requirement already satisfied: python-dateutil<3.0.0,>=2.1 in /home/michomanoly14892/.local/lib/python3.11/site-packages (from botocore<1.35.0,>=1.34.0->boto3) (2.9.0.post0)
Requirement already satisfied: urllib3!=2.2.0,<3,>=1.25.4 in /usr/lib/python3/dist-packages (from botocore<1.35.0,>=1.34.0->boto3) (1.26.12)
Requirement already satisfied: six>=1.5 in /home/michomanoly14892/.local/lib/python3.11/site-packages (from python-dateutil<3.0.0,>=2.1->botocore<1.35.0,>=1.34.0->boto3) (1.17.0)
WARNING: Error parsing dependencies of send2trash: Expected matching RIGHT_PARENTHESIS for LEFT_PARENTHESIS, after version specifier
    sys-platform (=="darwin") ; extra == 'objc'
                 ~^
[0;32m[22:21:59] âœ… boto3 installed successfully[0m
[0;32m[22:21:59] âœ… New architecture dependencies installation completed[0m
[0;32m[22:21:59] ğŸ§ª Testing new architecture imports...[0m
âœ… Config settings import successful
[0;32m[22:21:59] âœ… New architecture imports test passed[0m
[0;32m[22:21:59] ğŸ”§ Creating fallback dual_recorder for compatibility...[0m
[0;32m[22:21:59] âœ… Fallback dual_recorder created[0m
[0;32m[22:21:59] ğŸ”§ Fixing camera initialization issues...[0m
[0;32m[22:21:59] ğŸ“· Checking camera accessibility...[0m
[0;32m[22:21:59] ğŸ” Ensuring camera permissions...[0m
[0;32m[22:21:59] âœ… Camera device /dev/video0 found[0m
[0;32m[22:21:59] âœ… Camera device /dev/video1 found[0m
[0;32m[22:21:59] âœ… Camera initialization fixes applied[0m
[0;32m[22:21:59] ğŸ”§ Ensuring dual_recorder.py is correct and executable...[0m
[0;32m[22:21:59] ğŸ“„ Force copying dual_recorder.py from source...[0m
[0;32m[22:21:59] âœ… dual_recorder.py copied and made executable[0m
[1;33m[22:21:59] WARNING: âš ï¸ WARNING: File may not be the correct version[0m
[0;32m[22:21:59] âœ… Dual recorder setup completed[0m
[0;32m[22:21:59] ğŸ§ª Testing dual_recorder functionality...[0m
âœ… New architecture imports successful
[0;32m[22:21:59] âœ… New architecture dual_recorder should work[0m
[0;32m[22:21:59] ğŸ”„ Force restarting dual_recorder service...[0m
[0;32m[22:22:05] âœ… dual_recorder service restarted successfully[0m
[0;32m[22:22:05] ğŸ”§ Ensuring all required files and directories exist...[0m
[0;32m[22:22:05] ğŸ“ Creating logs directory...[0m
[0;32m[22:22:05] âœ… Logs directory created with proper permissions[0m
[0;32m[22:22:05] ğŸ“„ Creating system_status.log file...[0m
[0;32m[22:22:05] âœ… system_status.log file created with proper permissions[0m
[0;32m[22:22:05] ğŸ“„ Copying system_status.py to deployment directory...[0m
[0;32m[22:22:05] âœ… system_status.py copied with proper permissions[0m
[0;32m[22:22:05] ğŸ“„ Creating all required log files...[0m
[0;32m[22:22:05] âœ… Fixed permissions for existing video_worker.log[0m
[0;32m[22:22:05] âœ… Fixed permissions for existing dual_recorder.log[0m
[0;32m[22:22:05] âœ… Fixed permissions for existing api_server.log[0m
[0;32m[22:22:05] âœ… Fixed permissions for existing health_check.log[0m
[0;32m[22:22:05] âœ… Fixed permissions for existing service_monitor.log[0m
[0;32m[22:22:05] âœ… All required files and directories created with proper permissions[0m
[0;32m[22:22:05] ğŸ”§ Handling service restart issues...[0m
[0;32m[22:22:05] ğŸ›‘ Stopping all services to break restart loops...[0m
[0;32m[22:22:10] ğŸ§¹ Killing any remaining service processes...[0m
[0;32m[22:22:13] âœ… Service restart issues handled[0m
[0;32m[22:22:13] ğŸ”§ Ensuring all services are properly enabled...[0m
[0;32m[22:22:13] ğŸ”§ Enabling dual_recorder.service for auto-start...[0m
[0;32m[22:22:13] âœ… dual_recorder.service enabled successfully[0m
[0;32m[22:22:13] ğŸ”§ Enabling video_worker.service for auto-start...[0m
[0;32m[22:22:13] âœ… video_worker.service enabled successfully[0m
[0;32m[22:22:13] ğŸ”§ Enabling ezrec-api.service for auto-start...[0m
[0;32m[22:22:14] âœ… ezrec-api.service enabled successfully[0m
[0;32m[22:22:14] ğŸ”§ Enabling system_status.service for auto-start...[0m
[0;32m[22:22:14] âœ… system_status.service enabled successfully[0m
[0;32m[22:22:14] ğŸ”§ Enabling system_status.timer for auto-start...[0m
[0;32m[22:22:14] âœ… system_status.timer enabled successfully[0m
[0;32m[22:22:14] ğŸ” Verifying services are enabled...[0m
[0;32m[22:22:14] âœ… dual_recorder.service is enabled[0m
[0;32m[22:22:14] âœ… video_worker.service is enabled[0m
[0;32m[22:22:14] âœ… ezrec-api.service is enabled[0m
[0;32m[22:22:14] âœ… system_status.service is enabled[0m
[0;32m[22:22:14] âœ… All services properly enabled for auto-start[0m
[0;34m[22:22:14] STEP: 2. Starting all services safely[0m
[0;32m[22:22:14] ğŸ”§ Starting all services safely with port conflict prevention...[0m
[0;32m[22:22:14] ğŸ”§ Fixing port conflicts with comprehensive cleanup...[0m
[0;32m[22:22:14] ğŸ§¹ Performing comprehensive system cleanup...[0m
[0;32m[22:22:14] ğŸ›‘ Stopping all EZREC services...[0m
[0;32m[22:22:14] ğŸ“· Killing all camera-related processes...[0m
[0;32m[22:22:14] ğŸ Killing Python camera processes...[0m
[0;32m[22:22:14] ğŸ”“ Clearing camera device locks...[0m
[0;32m[22:22:15] ğŸ—‘ï¸ Clearing booking cache...[0m
[0;32m[22:22:15] ğŸ—‘ï¸ Removing booking cache: /opt/ezrec-backend/backend/bookings.json[0m
[0;32m[22:22:15] ğŸ—‘ï¸ Clearing temporary recording files...[0m
[0;32m[22:22:15] ğŸ”„ Resetting camera devices...[0m
[0;32m[22:22:18] âœ… Comprehensive system cleanup completed[0m
[0;32m[22:22:18] ğŸ§¹ Comprehensive port cleanup...[0m
[0;32m[22:22:18] ğŸ§¹ Killing processes by name...[0m
[0;32m[22:22:18] ğŸ§¹ Killing any remaining Python service processes...[0m
[0;32m[22:22:21] ğŸ§¹ Force killing any remaining processes on ports 8000 and 9000...[0m
[0;32m[22:22:24] âœ… Port 8000 is now free[0m
[0;32m[22:22:24] âœ… Port 9000 is now free[0m
[0;32m[22:22:24] âœ… Comprehensive port conflict resolution completed[0m
[0;32m[22:22:24] ğŸš€ Starting ezrec-api.service...[0m
[0;32m[22:22:24] ğŸ”§ Special handling for API service...[0m
[0;32m[22:22:24] âœ… ezrec-api.service started successfully[0m
[0;32m[22:22:24] â³ Waiting for API service to be ready...[0m
[0;32m[22:22:34] âœ… API service is responding[0m
[0;32m[22:22:37] ğŸš€ Starting dual_recorder.service...[0m
[0;32m[22:22:37] âœ… dual_recorder.service started successfully[0m
[0;32m[22:22:37] â³ Waiting longer for dual_recorder to fully initialize...[0m
[0;32m[22:22:47] ğŸš€ Starting video_worker.service...[0m
[0;32m[22:22:47] âœ… video_worker.service started successfully[0m
[0;32m[22:22:47] â³ Waiting longer for video_worker to fully initialize...[0m
[0;32m[22:22:57] ğŸš€ Starting system_status.service...[0m
[0;32m[22:22:57] ğŸ”§ Special handling for system_status service...[0m
[0;32m[22:22:57] âœ… system_status.log file exists and is writable[0m
[0;32m[22:23:00] âœ… system_status.service started successfully[0m
[0;32m[22:23:03] ğŸš€ Starting system_status.timer...[0m
[0;32m[22:23:03] âœ… system_status.timer started successfully[0m
[0;32m[22:23:03] âœ… All services started safely[0m
[0;32m[22:23:03] â³ Waiting for all services to fully initialize...[0m
[0;34m[22:23:18] STEP: 3. Verifying system completely[0m
[0;32m[22:23:18] ğŸ” Performing comprehensive system verification...[0m
[0;32m[22:23:18] ğŸ§ª Checking all services are running...[0m
[0;32m[22:23:18] âœ… dual_recorder.service is running[0m
[0;32m[22:23:18] âœ… video_worker.service is running[0m
[0;32m[22:23:18] âœ… ezrec-api.service is running[0m
[0;32m[22:23:18] âœ… system_status.service is running[0m
[0;32m[22:23:18] ğŸ§ª Testing API endpoints...[0m
[0;32m[22:23:18] âœ… API /test-alive endpoint is responding[0m
[0;32m[22:23:18] âœ… API /status endpoint is responding[0m
[0;32m[22:23:18] ğŸ§ª Testing Python imports...[0m
âœ… Backend imports working
[0;32m[22:23:18] âœ… Backend Python imports are working[0m
âœ… API imports working
[0;32m[22:23:18] âœ… API Python imports are working[0m
[0;32m[22:23:18] ğŸ§ª Testing Cloudflare tunnel...[0m
[0;32m[22:23:19] âœ… Cloudflare tunnel is running[0m
[0;32m[22:23:19] ğŸ‰ All system verification checks passed![0m
[0;32m[22:23:19] â³ Waiting for services to settle before final status check...[0m
[0;34m[22:23:24] STEP: 4. Final system status[0m

=== FINAL SYSTEM STATUS ===
âœ… dual_recorder.service: RUNNING
âœ… video_worker.service: RUNNING
âœ… ezrec-api.service: RUNNING
âœ… system_status.service: RUNNING
âœ… cloudflared.service: RUNNING
âœ… External API: ACCESSIBLE
[0;32m[22:23:24] ğŸ‰ Deployment completed successfully![0m
[0;32m[22:23:24] âœ… All services are running and responding correctly[0m
[0;32m[22:23:24] âœ… External API is accessible via Cloudflare tunnel[0m
[0;32m[22:23:24] âœ… System is ready for frontend testing[0m
